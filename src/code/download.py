import requests
import zipfile
from pathlib import Path
from tqdm import tqdm


def download_file_from_nishika(download_url: str, dirpath: Path, unzip: bool = True) -> None:
    """
    指定したURLからファイルをダウンロードし、指定したディレクトリに保存します。

    Args:
        download_url (str): ダウンロードするファイルのURL (データタブにある `COPY URL`)
        dirpath (Path): ファイルを保存するディレクトリのパス
        unzip (bool): ダウンロードしたファイルがZIP形式の場合に解凍するかどうかを指定。デフォルトはTrue

    Returns:
        None
    """

    # ファイルのダウンロードと保存
    response = requests.get(download_url)
    filename = download_url.split("?")[-2].split("/")[-1]
    filepath = dirpath / filename
    # print(filename)

    if not filepath.is_file():
        with open(filepath, "wb") as f:
            f.write(response.content)

        if unzip and filename.endswith(".zip"):
            # ! unzip -d $dirpath $filepath
            with zipfile.ZipFile(filepath, 'r') as zip_ref:
                zip_ref.extractall(dirpath)


# 要変更
download_urls = [
    # train.csv
    "https://s3.ap-northeast-1.amazonaws.com/nishika.assets.private/competitions/48/data/train.csv?response-content-disposition=attachment%3B%20filename%3Dtrain.csv&AWSAccessKeyId=ASIA3NMWWMCVUWGWGKKH&Signature=W1jfXQFMQ0KfpeL4wHAXCW1SVeY%3D&x-amz-security-token=IQoJb3JpZ2luX2VjEAkaDmFwLW5vcnRoZWFzdC0xIkcwRQIhAJeCSo9apuCp1FkK5cxqD7SfEdoNHEPY8iozEZspqveJAiBiObCSmNx0sVJ54oAKnOChj%2BgS10GIe4BKCNpRYiuSliqCBAhzEAQaDDc4NDY4NDQ0MTc3MSIMQftT7btiTxGkizZMKt8DLXgwvyUCX5A7PhXKAoG2aKuK%2F2k7UiAInnDqrUkLcnACXTQMxWeQecHnkUIgApklWpTK4l04Z4M3Lu6aZA4mqWBv81yImTkXeI8%2F3BB9ImuI8qfgzQ9d8H1c8L7896%2BsuPOafZfVIFJWw3Tb6X0UZ1pkc82FONUZLdqJu4KgnYuJtIVXrGFHNBmnFkR3NOmtI2AcR3CxRSeNNryHfM1hvpU35J4Y0rUXX3xNb8Nuj9MxaY%2BvWMZwc7Rai2wUVXqRu%2BuUIDzDhNO2ahlqXRYitOA4NUmOlQQddi1trHDJErEBEuAI0gu4Jr%2FrxxTIFCAp4OwQRjM6dClnWo%2B6b9isxJBiEC3rirEgms8gXKz5jn5%2Fv7ep69B%2F%2BPmwxgw1BY1qBmpkkTApZbZK2tGDeWU7f4KbYGpgIKGtOtUmnXz3psrqVN2Dl%2FnWWbfRm9gGEENaQk2EtuKhw65av1cQHA0SrNF4B0s%2BygucMDvkWMf5ofH541LbacQQ5OdMcdK3gciSw4E9tluyJ3Ud%2BU8%2B2GACVQ6h%2BZ504IQQ%2FFh8qYbbW%2FbBIll4vL85DnKImm4kjyI5K4DAUu1JKpNiPe%2F9extbFbwN9pNGOaLcPEW6X2Vwn%2FuztQ2HQMNODH5hkY%2F0GjQwsPrvpAY6pQGZk385xStQ%2Fvl3Lo4mi9mb3vNm3t6RoowFn8ClZPkuPTqlsTguRo%2FftLOxxbm%2Boijtil%2FLOl5%2FCvV0172gwAEMj50vSxuCggzp5DWdzj68bXg0QL2m0IOpjJ8nnMLvgv1h56%2FDDmf6uPes%2BmvSW5b2PgQBP4YXQRT5STSJ%2BnNpl6ngdIMEOjt23pjohr6yxD5RmC8tHWJTqXvbqpemb5G1GLqtmMk%3D&Expires=1687962496",
    # test.csv
    "https://s3.ap-northeast-1.amazonaws.com/nishika.assets.private/competitions/48/data/test.csv?response-content-disposition=attachment%3B%20filename%3Dtest.csv&AWSAccessKeyId=ASIA3NMWWMCVUWGWGKKH&Signature=nbZxmGLMbM1uy1fg1v1zuswLDys%3D&x-amz-security-token=IQoJb3JpZ2luX2VjEAkaDmFwLW5vcnRoZWFzdC0xIkcwRQIhAJeCSo9apuCp1FkK5cxqD7SfEdoNHEPY8iozEZspqveJAiBiObCSmNx0sVJ54oAKnOChj%2BgS10GIe4BKCNpRYiuSliqCBAhzEAQaDDc4NDY4NDQ0MTc3MSIMQftT7btiTxGkizZMKt8DLXgwvyUCX5A7PhXKAoG2aKuK%2F2k7UiAInnDqrUkLcnACXTQMxWeQecHnkUIgApklWpTK4l04Z4M3Lu6aZA4mqWBv81yImTkXeI8%2F3BB9ImuI8qfgzQ9d8H1c8L7896%2BsuPOafZfVIFJWw3Tb6X0UZ1pkc82FONUZLdqJu4KgnYuJtIVXrGFHNBmnFkR3NOmtI2AcR3CxRSeNNryHfM1hvpU35J4Y0rUXX3xNb8Nuj9MxaY%2BvWMZwc7Rai2wUVXqRu%2BuUIDzDhNO2ahlqXRYitOA4NUmOlQQddi1trHDJErEBEuAI0gu4Jr%2FrxxTIFCAp4OwQRjM6dClnWo%2B6b9isxJBiEC3rirEgms8gXKz5jn5%2Fv7ep69B%2F%2BPmwxgw1BY1qBmpkkTApZbZK2tGDeWU7f4KbYGpgIKGtOtUmnXz3psrqVN2Dl%2FnWWbfRm9gGEENaQk2EtuKhw65av1cQHA0SrNF4B0s%2BygucMDvkWMf5ofH541LbacQQ5OdMcdK3gciSw4E9tluyJ3Ud%2BU8%2B2GACVQ6h%2BZ504IQQ%2FFh8qYbbW%2FbBIll4vL85DnKImm4kjyI5K4DAUu1JKpNiPe%2F9extbFbwN9pNGOaLcPEW6X2Vwn%2FuztQ2HQMNODH5hkY%2F0GjQwsPrvpAY6pQGZk385xStQ%2Fvl3Lo4mi9mb3vNm3t6RoowFn8ClZPkuPTqlsTguRo%2FftLOxxbm%2Boijtil%2FLOl5%2FCvV0172gwAEMj50vSxuCggzp5DWdzj68bXg0QL2m0IOpjJ8nnMLvgv1h56%2FDDmf6uPes%2BmvSW5b2PgQBP4YXQRT5STSJ%2BnNpl6ngdIMEOjt23pjohr6yxD5RmC8tHWJTqXvbqpemb5G1GLqtmMk%3D&Expires=1687962496",
    # sample_submission.csv
    "https://s3.ap-northeast-1.amazonaws.com/nishika.assets.private/competitions/48/data/sample_submission.csv?response-content-disposition=attachment%3B%20filename%3Dsample_submission.csv&AWSAccessKeyId=ASIA3NMWWMCVUWGWGKKH&Signature=CTKW%2BbkzmR1G3oO9tBbDQ51XALA%3D&x-amz-security-token=IQoJb3JpZ2luX2VjEAkaDmFwLW5vcnRoZWFzdC0xIkcwRQIhAJeCSo9apuCp1FkK5cxqD7SfEdoNHEPY8iozEZspqveJAiBiObCSmNx0sVJ54oAKnOChj%2BgS10GIe4BKCNpRYiuSliqCBAhzEAQaDDc4NDY4NDQ0MTc3MSIMQftT7btiTxGkizZMKt8DLXgwvyUCX5A7PhXKAoG2aKuK%2F2k7UiAInnDqrUkLcnACXTQMxWeQecHnkUIgApklWpTK4l04Z4M3Lu6aZA4mqWBv81yImTkXeI8%2F3BB9ImuI8qfgzQ9d8H1c8L7896%2BsuPOafZfVIFJWw3Tb6X0UZ1pkc82FONUZLdqJu4KgnYuJtIVXrGFHNBmnFkR3NOmtI2AcR3CxRSeNNryHfM1hvpU35J4Y0rUXX3xNb8Nuj9MxaY%2BvWMZwc7Rai2wUVXqRu%2BuUIDzDhNO2ahlqXRYitOA4NUmOlQQddi1trHDJErEBEuAI0gu4Jr%2FrxxTIFCAp4OwQRjM6dClnWo%2B6b9isxJBiEC3rirEgms8gXKz5jn5%2Fv7ep69B%2F%2BPmwxgw1BY1qBmpkkTApZbZK2tGDeWU7f4KbYGpgIKGtOtUmnXz3psrqVN2Dl%2FnWWbfRm9gGEENaQk2EtuKhw65av1cQHA0SrNF4B0s%2BygucMDvkWMf5ofH541LbacQQ5OdMcdK3gciSw4E9tluyJ3Ud%2BU8%2B2GACVQ6h%2BZ504IQQ%2FFh8qYbbW%2FbBIll4vL85DnKImm4kjyI5K4DAUu1JKpNiPe%2F9extbFbwN9pNGOaLcPEW6X2Vwn%2FuztQ2HQMNODH5hkY%2F0GjQwsPrvpAY6pQGZk385xStQ%2Fvl3Lo4mi9mb3vNm3t6RoowFn8ClZPkuPTqlsTguRo%2FftLOxxbm%2Boijtil%2FLOl5%2FCvV0172gwAEMj50vSxuCggzp5DWdzj68bXg0QL2m0IOpjJ8nnMLvgv1h56%2FDDmf6uPes%2BmvSW5b2PgQBP4YXQRT5STSJ%2BnNpl6ngdIMEOjt23pjohr6yxD5RmC8tHWJTqXvbqpemb5G1GLqtmMk%3D&Expires=1687962496",
    # query_images.zip
    "https://s3.ap-northeast-1.amazonaws.com/nishika.assets.private/competitions/48/data/query_images.zip?response-content-disposition=attachment%3B%20filename%3Dquery_images.zip&AWSAccessKeyId=ASIA3NMWWMCVUWGWGKKH&Signature=bfAmccq6g5TCHY3ie4qMLzoKVgE%3D&x-amz-security-token=IQoJb3JpZ2luX2VjEAkaDmFwLW5vcnRoZWFzdC0xIkcwRQIhAJeCSo9apuCp1FkK5cxqD7SfEdoNHEPY8iozEZspqveJAiBiObCSmNx0sVJ54oAKnOChj%2BgS10GIe4BKCNpRYiuSliqCBAhzEAQaDDc4NDY4NDQ0MTc3MSIMQftT7btiTxGkizZMKt8DLXgwvyUCX5A7PhXKAoG2aKuK%2F2k7UiAInnDqrUkLcnACXTQMxWeQecHnkUIgApklWpTK4l04Z4M3Lu6aZA4mqWBv81yImTkXeI8%2F3BB9ImuI8qfgzQ9d8H1c8L7896%2BsuPOafZfVIFJWw3Tb6X0UZ1pkc82FONUZLdqJu4KgnYuJtIVXrGFHNBmnFkR3NOmtI2AcR3CxRSeNNryHfM1hvpU35J4Y0rUXX3xNb8Nuj9MxaY%2BvWMZwc7Rai2wUVXqRu%2BuUIDzDhNO2ahlqXRYitOA4NUmOlQQddi1trHDJErEBEuAI0gu4Jr%2FrxxTIFCAp4OwQRjM6dClnWo%2B6b9isxJBiEC3rirEgms8gXKz5jn5%2Fv7ep69B%2F%2BPmwxgw1BY1qBmpkkTApZbZK2tGDeWU7f4KbYGpgIKGtOtUmnXz3psrqVN2Dl%2FnWWbfRm9gGEENaQk2EtuKhw65av1cQHA0SrNF4B0s%2BygucMDvkWMf5ofH541LbacQQ5OdMcdK3gciSw4E9tluyJ3Ud%2BU8%2B2GACVQ6h%2BZ504IQQ%2FFh8qYbbW%2FbBIll4vL85DnKImm4kjyI5K4DAUu1JKpNiPe%2F9extbFbwN9pNGOaLcPEW6X2Vwn%2FuztQ2HQMNODH5hkY%2F0GjQwsPrvpAY6pQGZk385xStQ%2Fvl3Lo4mi9mb3vNm3t6RoowFn8ClZPkuPTqlsTguRo%2FftLOxxbm%2Boijtil%2FLOl5%2FCvV0172gwAEMj50vSxuCggzp5DWdzj68bXg0QL2m0IOpjJ8nnMLvgv1h56%2FDDmf6uPes%2BmvSW5b2PgQBP4YXQRT5STSJ%2BnNpl6ngdIMEOjt23pjohr6yxD5RmC8tHWJTqXvbqpemb5G1GLqtmMk%3D&Expires=1687962496",
    # data_explanation.xlsx
    # "",
    # cite.csv
    "https://s3.ap-northeast-1.amazonaws.com/nishika.assets.private/competitions/48/data/cite.csv?response-content-disposition=attachment%3B%20filename%3Dcite.csv&AWSAccessKeyId=ASIA3NMWWMCVUWGWGKKH&Signature=S3pRouC3%2FwisxtqwFWd49k6j2U0%3D&x-amz-security-token=IQoJb3JpZ2luX2VjEAkaDmFwLW5vcnRoZWFzdC0xIkcwRQIhAJeCSo9apuCp1FkK5cxqD7SfEdoNHEPY8iozEZspqveJAiBiObCSmNx0sVJ54oAKnOChj%2BgS10GIe4BKCNpRYiuSliqCBAhzEAQaDDc4NDY4NDQ0MTc3MSIMQftT7btiTxGkizZMKt8DLXgwvyUCX5A7PhXKAoG2aKuK%2F2k7UiAInnDqrUkLcnACXTQMxWeQecHnkUIgApklWpTK4l04Z4M3Lu6aZA4mqWBv81yImTkXeI8%2F3BB9ImuI8qfgzQ9d8H1c8L7896%2BsuPOafZfVIFJWw3Tb6X0UZ1pkc82FONUZLdqJu4KgnYuJtIVXrGFHNBmnFkR3NOmtI2AcR3CxRSeNNryHfM1hvpU35J4Y0rUXX3xNb8Nuj9MxaY%2BvWMZwc7Rai2wUVXqRu%2BuUIDzDhNO2ahlqXRYitOA4NUmOlQQddi1trHDJErEBEuAI0gu4Jr%2FrxxTIFCAp4OwQRjM6dClnWo%2B6b9isxJBiEC3rirEgms8gXKz5jn5%2Fv7ep69B%2F%2BPmwxgw1BY1qBmpkkTApZbZK2tGDeWU7f4KbYGpgIKGtOtUmnXz3psrqVN2Dl%2FnWWbfRm9gGEENaQk2EtuKhw65av1cQHA0SrNF4B0s%2BygucMDvkWMf5ofH541LbacQQ5OdMcdK3gciSw4E9tluyJ3Ud%2BU8%2B2GACVQ6h%2BZ504IQQ%2FFh8qYbbW%2FbBIll4vL85DnKImm4kjyI5K4DAUu1JKpNiPe%2F9extbFbwN9pNGOaLcPEW6X2Vwn%2FuztQ2HQMNODH5hkY%2F0GjQwsPrvpAY6pQGZk385xStQ%2Fvl3Lo4mi9mb3vNm3t6RoowFn8ClZPkuPTqlsTguRo%2FftLOxxbm%2Boijtil%2FLOl5%2FCvV0172gwAEMj50vSxuCggzp5DWdzj68bXg0QL2m0IOpjJ8nnMLvgv1h56%2FDDmf6uPes%2BmvSW5b2PgQBP4YXQRT5STSJ%2BnNpl6ngdIMEOjt23pjohr6yxD5RmC8tHWJTqXvbqpemb5G1GLqtmMk%3D&Expires=1687962496",
    # cite_images.zip
    "https://s3.ap-northeast-1.amazonaws.com/nishika.assets.private/competitions/48/data/cite_images.zip?response-content-disposition=attachment%3B%20filename%3Dcite_images.zip&AWSAccessKeyId=ASIA3NMWWMCVUWGWGKKH&Signature=nIFxy%2FnIv6xpyYTtVkKpxT6bpw4%3D&x-amz-security-token=IQoJb3JpZ2luX2VjEAkaDmFwLW5vcnRoZWFzdC0xIkcwRQIhAJeCSo9apuCp1FkK5cxqD7SfEdoNHEPY8iozEZspqveJAiBiObCSmNx0sVJ54oAKnOChj%2BgS10GIe4BKCNpRYiuSliqCBAhzEAQaDDc4NDY4NDQ0MTc3MSIMQftT7btiTxGkizZMKt8DLXgwvyUCX5A7PhXKAoG2aKuK%2F2k7UiAInnDqrUkLcnACXTQMxWeQecHnkUIgApklWpTK4l04Z4M3Lu6aZA4mqWBv81yImTkXeI8%2F3BB9ImuI8qfgzQ9d8H1c8L7896%2BsuPOafZfVIFJWw3Tb6X0UZ1pkc82FONUZLdqJu4KgnYuJtIVXrGFHNBmnFkR3NOmtI2AcR3CxRSeNNryHfM1hvpU35J4Y0rUXX3xNb8Nuj9MxaY%2BvWMZwc7Rai2wUVXqRu%2BuUIDzDhNO2ahlqXRYitOA4NUmOlQQddi1trHDJErEBEuAI0gu4Jr%2FrxxTIFCAp4OwQRjM6dClnWo%2B6b9isxJBiEC3rirEgms8gXKz5jn5%2Fv7ep69B%2F%2BPmwxgw1BY1qBmpkkTApZbZK2tGDeWU7f4KbYGpgIKGtOtUmnXz3psrqVN2Dl%2FnWWbfRm9gGEENaQk2EtuKhw65av1cQHA0SrNF4B0s%2BygucMDvkWMf5ofH541LbacQQ5OdMcdK3gciSw4E9tluyJ3Ud%2BU8%2B2GACVQ6h%2BZ504IQQ%2FFh8qYbbW%2FbBIll4vL85DnKImm4kjyI5K4DAUu1JKpNiPe%2F9extbFbwN9pNGOaLcPEW6X2Vwn%2FuztQ2HQMNODH5hkY%2F0GjQwsPrvpAY6pQGZk385xStQ%2Fvl3Lo4mi9mb3vNm3t6RoowFn8ClZPkuPTqlsTguRo%2FftLOxxbm%2Boijtil%2FLOl5%2FCvV0172gwAEMj50vSxuCggzp5DWdzj68bXg0QL2m0IOpjJ8nnMLvgv1h56%2FDDmf6uPes%2BmvSW5b2PgQBP4YXQRT5STSJ%2BnNpl6ngdIMEOjt23pjohr6yxD5RmC8tHWJTqXvbqpemb5G1GLqtmMk%3D&Expires=1687962496",
]

output_dir = Path('./data')

for download_url in tqdm(download_urls):
    download_file_from_nishika(download_url, dirpath=output_dir)
    # break
